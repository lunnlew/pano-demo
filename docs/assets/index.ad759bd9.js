import{P as e,V as t,R as i,T as n,M as s,a as o,b as a,E as r,S as h,W as d,c,d as m,Q as l,e as u,r as v,o as w,f as p,g,p as y,h as f,i as D,j as K,F as E,k as b,w as M,l as L,m as C,n as U}from"./vendor.ff5513f2.js";function x(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}class T{constructor(t,i){this.movement={x:0,y:0},this.mouse={x:0,y:0},this.camera_target_angle={lng:0,lat:0},this.radius=0,this.isUserInteractive=!1,this.muliteTouchMode=!1,this.lastPonits=[],this.isUseKey=!1,this.onKeyLeft=!1,this.onKeyRight=!1,this.onKeyUp=!1,this.onKeyDown=!1,this.onKeyShift=!1,this.renderer=t,this.camera=new e(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.x=0,this.camera.position.y=0,this.camera.position.z=0,this.radius=i,this.camera.lookAt(i,0,0)}initEvent(){window.addEventListener("resize",this.onWindowResize.bind(this),!1),window.addEventListener("wheel",this.onDocumentMouseWheel.bind(this),!1),window.addEventListener("mousemove",this.onDocumentMouseMove.bind(this),!1),window.addEventListener("mousedown",this.onDocumentMouseDown.bind(this),!1),window.addEventListener("mouseup",this.onDocumentMouseUp.bind(this),!1),window.addEventListener("touchstart",this.onDocumentTouchStart.bind(this),!1),window.addEventListener("touchmove",this.onDocumentTouchMove.bind(this),!1),window.addEventListener("touchend",this.onDocumentTouchEnd.bind(this),!1),window.addEventListener("keydown",this.onDocumentKeyDown.bind(this),!1),window.addEventListener("keyup",this.onDocumentKeyUp.bind(this),!1)}removeEvent(){window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("wheel",this.onDocumentMouseWheel),window.removeEventListener("mousemove",this.onDocumentMouseMove),window.removeEventListener("mousedown",this.onDocumentMouseDown),window.removeEventListener("mouseup",this.onDocumentMouseUp),window.removeEventListener("touchstart",this.onDocumentTouchStart),window.removeEventListener("touchmove",this.onDocumentTouchMove),window.removeEventListener("touchend",this.onDocumentTouchEnd),window.removeEventListener("keydown",this.onDocumentKeyDown),window.removeEventListener("keyup",this.onDocumentKeyUp)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}onDocumentMouseWheel(e){let t=this.camera.fov+.05*e.deltaY;t>160&&(t=160),t<10&&(t=10),this.camera.fov=t,this.camera.updateProjectionMatrix()}onDocumentMouseMove(e){this.isUserInteractive&&(this.movement={x:e.movementX,y:e.movementY},this.mouse={x:e.clientX/window.innerWidth*2-1,y:-e.clientY/window.innerHeight*2+1})}onDocumentMouseDown(){this.isUserInteractive=!0}onDocumentMouseUp(){this.isUserInteractive=!1,this.movement={x:0,y:0},this.mouse={x:0,y:0}}onDocumentTouchStart(e){this.muliteTouchMode=e.touches.length>1,this.isUserInteractive=!0,this.lastPonits=[];for(let t of e.touches)this.lastPonits.push({pageX:t.pageX,pageY:t.pageY})}onDocumentTouchMove(e){if(this.muliteTouchMode){let t=this.lastPonits[0],i=this.lastPonits[1],n=e.touches,s=n[0],o=n[1],a=function(e,t){let i=x(e[0],e[1]),n=x(t[0],t[1]);return i-n>0?i/n:-n/i}([{x:t.pageX,y:t.pageY},{x:i.pageX,y:i.pageY}],[{x:s.pageX,y:s.pageY},{x:o.pageX,y:o.pageY}]),r=this.camera.fov+a;r>160&&(r=160),r<10&&(r=10),this.camera.fov=r,this.camera.updateProjectionMatrix()}else{let t=this.lastPonits[0],i=Array.from(e.touches).pop();this.lastPonits[0]=i,this.movement={x:i.pageX-(null==t?void 0:t.pageX),y:i.pageY-(null==t?void 0:t.pageY)},this.mouse={x:i.pageX/window.innerWidth*2-1,y:-i.pageY/window.innerHeight*2+1}}}onDocumentTouchEnd(e){this.muliteTouchMode=!1,this.isUserInteractive=!1,this.lastPonits=[],this.movement={x:0,y:0},this.mouse={x:0,y:0}}onDocumentKeyDown(e){switch(e.keyCode||e.which||e.charCode){case 65:case 37:this.onKeyLeft=!0,this.onKeyRight=!1;break;case 68:case 39:this.onKeyRight=!0,this.onKeyLeft=!1;break;case 87:case 38:this.onKeyUp=!0,this.onKeyDown=!1;break;case 83:case 40:this.onKeyDown=!0,this.onKeyUp=!1;break;case 16:this.onKeyShift=!0}this.isUseKey=this.onKeyLeft||this.onKeyRight||this.onKeyUp||this.onKeyDown,this.isUserInteractive=!0}onDocumentKeyUp(e){switch(e.keyCode||e.which||e.charCode){case 65:case 37:this.onKeyLeft=!1;break;case 68:case 39:this.onKeyRight=!1;break;case 87:case 38:this.onKeyUp=!1;break;case 83:case 40:this.onKeyDown=!1;break;case 16:this.onKeyShift=!1}this.isUseKey=this.onKeyLeft||this.onKeyRight||this.onKeyUp||this.onKeyDown,this.isUserInteractive=this.isUseKey||this.onKeyShift}convertDistanceToAngle(){this.camera_target_angle.lng-=this.movement.x/this.radius*.01,this.camera_target_angle.lat+=this.movement.y/this.radius*.01}updateKeyAngle(){let e=1,t=1;this.onKeyShift&&(e=5,t=5),this.onKeyDown&&(this.camera_target_angle.lat+=.01*e),this.onKeyUp&&(this.camera_target_angle.lat-=.01*e),this.onKeyLeft&&(this.camera_target_angle.lng-=.01*t),this.onKeyRight&&(this.camera_target_angle.lng+=.01*t)}update(){return this.isUserInteractive&&(this.isUseKey?this.updateKeyAngle():this.muliteTouchMode||this.convertDistanceToAngle()),this.camera_target_angle}getIntersects(e){var n=new t(this.mouse.x,this.mouse.y,.5).unproject(this.camera);return new i(this.camera.position,n.sub(this.camera.position).normalize()).intersectObjects(e)}getCamera(){return this.camera}}class R{constructor(e){this.last_abg={alpha:0,beta:0},this.camera_target_angle={lng:0,lat:0},this.screenOrientation=0,this.deviceOrientation={alpha:0,beta:90,gamma:0},this.camera=e}onOrientationchange(){let e=0;"string"==typeof window.orientation&&(e=0),this.screenOrientation=e||0}onDeviceorientation(e){this.deviceOrientation=e}initEvent(){window.addEventListener("orientationchange",this.onOrientationchange.bind(this),!1),window.addEventListener("deviceorientation",this.onDeviceorientation.bind(this),!1)}removeEvent(){window.removeEventListener("orientationchange",this.onOrientationchange),window.removeEventListener("deviceorientation",this.onDeviceorientation)}update(){return{deviceOrientation:this.deviceOrientation,screenOrientation:this.screenOrientation}}}class _{constructor(e){this.radius=0,this.enableStats=!0,this.radius=e,this.initScene(),this.initRenderer(),this.initGeometry(),this.initControl()}async loadImage(e){var t;const i=new n;if(this.material)null==(t=this.material.map)||t.dispose(),this.material.map=i.load(e);else{let t=i.load(e);this.material=new s({map:t});const n=new o(this.geometry,this.material);this.scene.add(n)}}async start(){let e=this;this.initStats(),this.initEvent(),this.mountDom();let t=e.perspectiveControl.getCamera();!function i(){e.renderer.render(e.scene,t);let n=e.deviceOrientationControl.update(),s=e.perspectiveControl.update();e.updateCamera(t,n,s),e.enableStats&&(e.stats.begin(),e.stats.end()),requestAnimationFrame(i)}()}updateCamera(e,{deviceOrientation:i,screenOrientation:n},s){var o=i.alpha?a.degToRad(i.alpha):0,h=i.beta?a.degToRad(i.beta):0,d=i.gamma?a.degToRad(i.gamma):0,c=n?a.degToRad(n):0,m=new l(0,-Math.sqrt(.5),0,Math.sqrt(.5)),u=new r;u.set(h,o,-d,"YXZ"),e.quaternion.setFromEuler(u),e.quaternion.multiply(m);var v=new l,w=new t(0,0,1);e.quaternion.multiply(v.setFromAxisAngle(w,-c));let{lng:p,lat:g}=s;var y=new r;y.set(g,-p,0,"YXZ");var f=new l;f.setFromEuler(y),e.quaternion.multiply(f)}mountDom(){var e;this.mounted||(null==(e=this.dom)||e.appendChild(this.renderer.domElement),this.mounted=!0)}initScene(){this.scene=new h}initRenderer(){this.renderer=new d({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight)}initGeometry(){this.geometry=new c(this.radius,64,64),this.geometry.scale(-1,1,1)}initControl(){this.perspectiveControl=new T(this.renderer,this.radius),this.deviceOrientationControl=new R(this.perspectiveControl.getCamera())}initStats(){var e;this.enableStats&&(this.stats=m(),this.stats.setMode(0),null==(e=this.dom)||e.append(this.stats.dom))}initEvent(){this.perspectiveControl.initEvent(),this.deviceOrientationControl.initEvent()}mountTo(e){return this.dom=e,this}destory(){this.perspectiveControl.removeEvent(),this.deviceOrientationControl.removeEvent(),this.renderer.domElement.remove()}}var k="/pano-demo/assets/1.f3289c15.jpg",O=u({name:"PanoPlayer",setup:()=>{const e=v(null),t=new _(2);return w((async()=>{t.mountTo(e.value).start(),t.loadImage(k)})),p((()=>{t.destory()})),v({}),{images:g([k,"/pano-demo/assets/2.f24e5cdb.jpg","/pano-demo/assets/3.cd68e2c7.jpg"]),palyer:e,fileChange:function(e){var i;if((null==(i=e.target.files)?void 0:i.length)>0){let i=new FileReader;i.readAsDataURL(e.target.files[0]),i.onloadend=function(){let e=this.result;t.loadImage(e)}}},changeImage:function(e){t.loadImage(e)}}}});const P=M("data-v-f6efdb3e");y("data-v-f6efdb3e");const S={id:"palyer",ref:"palyer",style:{position:"absolute","z-index":"0",top:"0",bottom:"0",left:"0",right:"0",width:"100%",height:"100%",overflow:"hidden"}},I={class:"ctl"},Y={class:"thumb-container"},W={class:"thumb-list"};f();const X=P(((e,t,i,n,s,o)=>(L(),D(E,null,[K("div",S,null,512),K("div",I,[K("input",{type:"file",onChange:t[1]||(t[1]=(...t)=>e.fileChange&&e.fileChange(...t)),ref:"img"},null,544)]),K("div",Y,[K("ul",W,[(L(!0),D(E,null,b(e.images,((t,i)=>(L(),D("li",{key:i,onClick:i=>e.changeImage(t)},[K("img",{src:t},null,8,["src"])],8,["onClick"])))),128))])])],64))));O.render=X,O.__scopeId="data-v-f6efdb3e";var A=u({name:"App",components:{PanoPlayer:O}});A.render=function(e,t,i,n,s,o){const a=C("pano-player");return L(),D(a)},U(A).mount("#app");
