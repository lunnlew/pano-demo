import{P as e,S as t,W as i,a as n,T as s,M as o,b as a,c as h,d as r,o as c,e as d,r as m,p as l,f as u,g as w,w as v,h as p,i as g,j as y}from"./vendor.e2fedf67.js";function b(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}class K{constructor(t,i){this.movement={x:0,y:0},this.camera_target_angle={lng:0,lat:0},this.isUserInteractive=!1,this.muliteTouchMode=!1,this.lastPonits=[],this.isUseKey=!1,this.onKeyLeft=!1,this.onKeyRight=!1,this.onKeyUp=!1,this.onKeyDown=!1,this.onKeyShift=!1,this.last_abg={alpha:0,beta:0},this.renderer=t,this.camera=new e(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.x=0,this.camera.position.y=0,this.camera.position.z=0,this.camera.lookAt(i,0,0)}initEvent(){window.addEventListener("resize",this.onWindowResize.bind(this),!1),window.addEventListener("wheel",this.onDocumentMouseWheel.bind(this),!1),window.addEventListener("mousemove",this.onDocumentMouseMove.bind(this),!1),window.addEventListener("mousedown",this.onDocumentMouseDown.bind(this),!1),window.addEventListener("mouseup",this.onDocumentMouseUp.bind(this),!1),window.addEventListener("touchstart",this.onDocumentTouchStart.bind(this),!1),window.addEventListener("touchmove",this.onDocumentTouchMove.bind(this),!1),window.addEventListener("touchend",this.onDocumentTouchEnd.bind(this),!1),window.addEventListener("keydown",this.onDocumentKeyDown.bind(this),!1),window.addEventListener("keyup",this.onDocumentKeyUp.bind(this),!1),window.addEventListener("deviceorientation",this.onDeviceorientation.bind(this),!1)}removeEvent(){window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("wheel",this.onDocumentMouseWheel),window.removeEventListener("mousemove",this.onDocumentMouseMove),window.removeEventListener("mousedown",this.onDocumentMouseDown),window.removeEventListener("mouseup",this.onDocumentMouseUp),window.removeEventListener("touchstart",this.onDocumentTouchStart),window.removeEventListener("touchmove",this.onDocumentTouchMove),window.removeEventListener("touchend",this.onDocumentTouchEnd),window.removeEventListener("keydown",this.onDocumentKeyDown),window.removeEventListener("keyup",this.onDocumentKeyUp),window.removeEventListener("deviceorientation",this.onDeviceorientation)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}onDocumentMouseWheel(e){let t=this.camera.fov+.05*e.deltaY;t>160&&(t=160),t<10&&(t=10),this.camera.fov=t,this.camera.updateProjectionMatrix()}onDocumentMouseMove(e){this.isUserInteractive&&(this.movement={x:e.movementX,y:e.movementY},console.log(this.movement))}onDocumentMouseDown(){this.isUserInteractive=!0}onDocumentMouseUp(){this.isUserInteractive=!1,this.movement={x:0,y:0}}onDocumentTouchStart(e){this.muliteTouchMode=e.changedTouches.length>1,this.isUserInteractive=!0,this.lastPonits=[];for(let t of e.changedTouches)this.lastPonits.push({pageX:t.pageX,pageY:t.pageY})}onDocumentTouchMove(e){if(this.muliteTouchMode){let n=this.lastPonits[0],s=this.lastPonits[1],o=e.changedTouches,a=o[0],h=o[1],r=(t=[{x:n.pageX,y:n.pageY},{x:s.pageX,y:s.pageY}],i=[{x:a.pageX,y:a.pageY},{x:h.pageX,y:h.pageY}],b(t[0],t[1])/b(i[0],i[1]));this.camera.fov+=.01*r,this.camera.updateProjectionMatrix()}else{let t=this.lastPonits[0],i=Array.from(e.changedTouches).pop();this.lastPonits[0]=i,this.movement={x:i.pageX-(null==t?void 0:t.pageX),y:i.pageY-(null==t?void 0:t.pageY)}}var t,i}onDocumentTouchEnd(e){this.muliteTouchMode=!1,this.isUserInteractive=!1,this.lastPonits=[],this.movement={x:0,y:0}}onDocumentKeyDown(e){switch(e.keyCode||e.which||e.charCode){case 65:case 37:this.onKeyLeft=!0,this.onKeyRight=!1;break;case 68:case 39:this.onKeyRight=!0,this.onKeyLeft=!1;break;case 87:case 38:this.onKeyUp=!0,this.onKeyDown=!1;break;case 83:case 40:this.onKeyDown=!0,this.onKeyUp=!1;break;case 16:this.onKeyShift=!0}this.isUseKey=this.onKeyLeft||this.onKeyRight||this.onKeyUp||this.onKeyDown,this.isUserInteractive=!0}onDocumentKeyUp(e){switch(e.keyCode||e.which||e.charCode){case 65:case 37:this.onKeyLeft=!1;break;case 68:case 39:this.onKeyRight=!1;break;case 87:case 38:this.onKeyUp=!1;break;case 83:case 40:this.onKeyDown=!1;break;case 16:this.onKeyShift=!1}this.isUseKey=this.onKeyLeft||this.onKeyRight||this.onKeyUp||this.onKeyDown,this.isUserInteractive=this.isUseKey||this.onKeyShift}onDeviceorientation(e){let t=0,i=0;switch(window.orientation){case 0:t=e.alpha-this.last_abg.alpha,i=e.beta-this.last_abg.beta,this.last_abg.alpha=e.alpha,this.last_abg.beta=e.beta;case 90:t=e.alpha-this.last_abg.alpha,i=e.beta-this.last_abg.beta-90,this.last_abg.alpha=e.alpha,this.last_abg.beta=e.beta-90}this.camera_target_angle.lng-=.01*t,this.camera_target_angle.lat+=.01*i}convertDistanceToAngle(e){this.camera_target_angle.lng-=this.movement.x/e*.01,this.camera_target_angle.lat+=this.movement.y/e*.01}updateKeyAngle(){let e=1,t=1;this.onKeyShift&&(e=5,t=5),this.onKeyDown&&(this.camera_target_angle.lat+=.01*e),this.onKeyUp&&(this.camera_target_angle.lat-=.01*e),this.onKeyLeft&&(this.camera_target_angle.lng-=.01*t),this.onKeyRight&&(this.camera_target_angle.lng+=.01*t)}update(e){this.isUserInteractive&&(this.isUseKey?this.updateKeyAngle():this.convertDistanceToAngle(e));let{lng:t,lat:i}=this.camera_target_angle,n=e*Math.cos(i)*Math.cos(t),s=e*Math.sin(i),o=e*Math.cos(i)*Math.sin(t);this.camera.lookAt(n,s,o)}render(e){this.renderer.render(e,this.camera)}}class D{constructor(e,t){this.radius=0,this.enableStats=!0,this.radius=e,this.texture_resourse=t,this.initScene(),this.initRenderer(),this.initGeometry(),this.initControl()}async start(){let e=this;this.initStats(),await this.composeMaterial(),this.initEvent(),function t(){e.perspectiveControl.render(e.scene),e.perspectiveControl.update(e.radius),e.enableStats&&(e.stats.begin(),e.stats.end()),requestAnimationFrame(t)}()}initScene(){this.scene=new t}initRenderer(){this.renderer=new i({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight)}initGeometry(){this.geometry=new n(this.radius,64,64),this.geometry.scale(-1,1,1)}async composeMaterial(){const e=new s,t=new o({map:e.load(this.texture_resourse)}),i=new a(this.geometry,t);this.scene.add(i)}initControl(){this.perspectiveControl=new K(this.renderer,this.radius)}initStats(){var e;this.enableStats&&(this.stats=h(),this.stats.setMode(0),null==(e=this.dom)||e.append(this.stats.dom))}initEvent(){this.perspectiveControl.initEvent()}mountTo(e){return this.dom=e,null==e||e.appendChild(this.renderer.domElement),this}destory(){this.removeEvent()}removeEvent(){this.perspectiveControl.removeEvent()}}var M=r({name:"PanoPlayer",setup:()=>{const e=new D(2,"/pano-demo/assets/1.f3289c15.jpg");c((async()=>{e.mountTo(t.value).start()})),d((()=>{e.destory()}));const t=m(null);return{img:t}}});const E=v("data-v-0b7757fe");l("data-v-0b7757fe");const f={id:"img",ref:"img",style:{position:"absolute","z-index":"0",top:"0",bottom:"0",left:"0",right:"0",width:"100%",height:"100%",overflow:"hidden"}};u();const _=E(((e,t,i,n,s,o)=>(p(),w("div",f,null,512))));M.render=_,M.__scopeId="data-v-0b7757fe";var L=r({name:"App",components:{PanoPlayer:M}});L.render=function(e,t,i,n,s,o){const a=g("pano-player");return p(),w(a)},y(L).mount("#app");
